<!DOCTYPE html>
<html>
<head>
    <title>LED Display</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet" />
    <style>
        body {
            background: black;
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        #wrapper {
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            overflow: hidden;
            position: relative;
        }
        #display {
            white-space: nowrap;
            display: inline-block;
            position: absolute;
            font-size: 90px;
            font-weight: 500;
            color: #00ffcc;
            text-shadow: 0 0 5px #00ffcc, 0 0 10px #00ffcc;
            animation: scrollText 10s linear infinite;
            transition: color 0.5s ease;
            left: 0;
        }
        #animation-label {
            position: absolute;
            right: 20px;
            bottom: 20px;
            font-family: monospace;
            font-size: 16px;
            color: #0ff;
            text-shadow: 0 0 5px #0ff;
            user-select: none;
            pointer-events: none;
            opacity: 0.7;
            white-space: nowrap;
            z-index: 10;
        }

        @keyframes scrollText {
            0% { left: 100%; }
            100% { left: -100%; }
        }
        @keyframes blurPulse {
            0%, 100% { filter: blur(0); color: #00ffcc; }
            50% { filter: blur(2px); color: #00ffff; }
        }
        @keyframes zigzagMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(5px, -5px) rotate(2deg); }
            50% { transform: translate(10px, 0) rotate(0deg); }
            75% { transform: translate(5px, 5px) rotate(-2deg); }
        }
        @keyframes curveWave {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-15px); }
            50% { transform: translateY(0); }
            75% { transform: translateY(15px); }
        }
        @keyframes zoomPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        .wavezoom span {
            display: inline-block;
            animation-name: waveZoomAnim;
            animation-duration: 2.5s;
            animation-iteration-count: infinite;
            animation-timing-function: ease-in-out;
            margin-right: 8px;
        }
        @keyframes waveZoomAnim {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.3); }
        }

        /* Responsive fixes */
        @media (max-width: 600px) {
            #display {
                font-size: 40px;
                white-space: normal;
                position: relative;
                left: auto !important;
                right: auto !important;
                text-align: center;
                animation: none !important; /* optional: pause scroll on small devices */
            }
            #scrollingText {
                display: block;
                white-space: normal !important;
            }
            #animation-label {
                position: fixed !important;
                right: 10px;
                bottom: 10px;
                font-size: 14px;
                background: rgba(0, 0, 0, 0.7);
                padding: 4px 8px;
                border-radius: 5px;
                opacity: 0.9;
                z-index: 1000;
                white-space: nowrap;
                pointer-events: none;
                user-select: none;
            }
        }
    </style>
</head>
<body>
    <div id="wrapper">
        <div id="display">
            <div id="scrollingText" style="display: inline-block; white-space: nowrap;"></div>
        </div>
        <div id="animation-label"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const display = document.getElementById("display");
        const scrollText = document.getElementById("scrollingText");
        const animLabel = document.getElementById("animation-label");

        let wakeLock = null;

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLock.addEventListener('release', () => {
                        console.log('Wake Lock was released');
                        // Automatically try to re-acquire wake lock
                        requestWakeLock();
                    });
                    console.log('Wake Lock is active');
                }
            } catch (err) {
                console.error(`${err.name}, ${err.message}`);
            }
        }

        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden' && wakeLock !== null) {
                wakeLock.release();
                wakeLock = null;
            } else if (document.visibilityState === 'visible') {
                requestWakeLock();
            }
        });

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        setInterval(() => {
            const newColor = getRandomColor();
            display.style.color = newColor;
            display.style.textShadow = `0 0 5px ${newColor}, 0 0 10px ${newColor}`;
        }, 1000);

        function resetAnimations() {
            display.style.animation = 'scrollText 10s linear infinite';
            scrollText.style.animation = 'none';
            scrollText.classList.remove('wavezoom');
            scrollText.innerHTML = '';
            display.style.left = '0';
            display.style.right = 'auto';
            display.style.textAlign = 'left';
            display.style.transform = 'none';
        }

        function applyWaveZoom(text) {
            scrollText.innerHTML = '';
            scrollText.classList.add('wavezoom');
            for (let i = 0; i < text.length; i++) {
                const span = document.createElement('span');
                span.textContent = text[i];
                span.style.animationDelay = (i * 0.15) + 's';
                scrollText.appendChild(span);
            }
        }

        function setAnimations(type, msg) {
            const scroll = 'scrollText 10s linear infinite';
            const blur = 'blurPulse 3s ease-in-out infinite';
            const zigzag = 'zigzagMove 1.5s ease-in-out infinite';
            const curve = 'curveWave 2.5s ease-in-out infinite';
            const fade = 'fadeInOut 3s ease-in-out infinite';

            resetAnimations();

            // Request wake lock here to keep screen ON when text animation runs
            requestWakeLock();

            switch(type) {
                case 'blur':
                    display.style.animation = `${scroll}, ${blur}`;
                    scrollText.textContent = msg;
                    break;
                case 'zigzag':
                    display.style.animation = `${scroll}, ${zigzag}`;
                    scrollText.textContent = msg;
                    break;
                case 'blur+zigzag':
                    display.style.animation = `${scroll}, ${blur}, ${zigzag}`;
                    scrollText.textContent = msg;
                    break;
                case 'curve':
                    display.style.animation = `${scroll}, ${curve}`;
                    scrollText.textContent = msg;
                    break;
                case 'curve+blur':
                    display.style.animation = `${scroll}, ${curve}, ${blur}`;
                    scrollText.textContent = msg;
                    break;
                case 'wavezoom':
                    display.style.animation = scroll;
                    applyWaveZoom(msg);
                    break;
                case 'fadeinout':
                    display.style.animation = 'none';
                    scrollText.style.animation = fade;
                    display.style.left = '50%';
                    display.style.transform = 'translateX(-50%)';
                    display.style.textAlign = 'center';
                    scrollText.textContent = msg;
                    break;
                case 'none':
                    display.style.animation = 'none';
                    scrollText.textContent = msg;
                    break;
                default:
                    display.style.animation = scroll;
                    scrollText.textContent = msg;
            }
        }

        const socket = io();
        socket.on("update", (data) => {
            if (!data || data.trim() === '') {
                scrollText.textContent = 'Loading...';
                display.style.animation = 'none';
                return;
            }

            let [msg, anim] = data.split('|');
            msg = msg.trim();
            anim = anim ? anim.trim() : '';

            if (!msg) {
                scrollText.textContent = 'Loading...';
                display.style.animation = 'none';
                return;
            }

            setAnimations(anim, msg);
        });
    </script>

</body>
</html>
